
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Click Flow Test - Iframe Scenarios</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .iframe-container { border: 2px solid #007bff; padding: 10px; margin: 10px 0; background: #f8f9fa; }
        iframe { width: 100%; height: 300px; border: 1px solid #ddd; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .success { background: #28a745; color: white; }
        .warning { background: #ffc107; color: black; }
        .danger { background: #dc3545; color: white; }
        .info { background: #17a2b8; color: white; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
        .click-counter { font-weight: bold; color: #007bff; }
        .test-info { background: #e7f3ff; border-left: 4px solid #007bff; padding: 15px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Enhanced Click Flow Test - Iframe Scenarios</h1>
        <p>This page tests our enhanced 4-phase click fallback system with various iframe configurations.</p>
        
        <div class="test-section">
            <h2>ðŸ“Š Test Status</h2>
            <div id="status">Ready to test enhanced click flow...</div>
            <div class="log" id="click-log">Click log will appear here...</div>
        </div>

        <div class="test-section">
            <h2>ðŸŽ¯ Test 1: Simple Iframe Click</h2>
            <div class="test-info">
                <strong>What we're testing:</strong> Basic iframe element clicking using our enhanced selector format: <code>iframe#simple-iframe >>> #simple-btn</code>
            </div>
            <div class="iframe-container">
                <iframe id="simple-iframe" srcdoc="
                    <html><body style='padding: 20px; font-family: Arial;'>
                        <h3>Simple Iframe Test</h3>
                        <button id='simple-btn' class='success' onclick='handleClick("simple")'>Click Me (Simple)</button>
                        <p>This button is inside a simple iframe.</p>
                        <div id='simple-result'>No clicks yet</div>
                    </body></html>">
                </iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>ðŸŽ¯ Test 2: Nested Iframe Click</h2>
            <div class="test-info">
                <strong>What we're testing:</strong> Complex nested iframe clicking: <code>iframe#outer-iframe >>> iframe#inner-iframe >>> #nested-btn</code>
            </div>
            <div class="iframe-container">
                <iframe id="outer-iframe" srcdoc="
                    <html><body style='padding: 20px; font-family: Arial;'>
                        <h3>Outer Iframe</h3>
                        <p>This is the outer iframe containing another iframe.</p>
                        <iframe id='inner-iframe' srcdoc='<html><body style="padding: 20px; font-family: Arial;"><h3>Inner Iframe</h3><button id="nested-btn" class="warning" onclick="handleClick("nested")">Click Me (Nested)</button><p>This button is inside a nested iframe.</p><div id="nested-result">No clicks yet</div></body></html>'>
                        </iframe>
                    </body></html>">
                </iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>ðŸŽ¯ Test 3: Shadow DOM Iframe Click</h2>
            <div class="test-info">
                <strong>What we're testing:</strong> Shadow DOM within iframe clicking: <code>iframe#shadow-iframe >>> #shadow-host >>> #shadow-btn</code>
            </div>
            <div class="iframe-container">
                <iframe id="shadow-iframe" srcdoc="
                    <html><body style='padding: 20px; font-family: Arial;'>
                        <h3>Shadow DOM Iframe Test</h3>
                        <div id='shadow-host'></div>
                        <script>
                            const host = document.getElementById('shadow-host');
                            const shadow = host.attachShadow({mode: 'open'});
                            shadow.innerHTML = \`
                                <div style='padding: 10px; border: 2px solid #6f42c1; border-radius: 4px;'>
                                    <h4>Shadow DOM Content</h4>
                                    <button id='shadow-btn' class='info' onclick='handleClick("shadow")'>Click Me (Shadow)</button>
                                    <p>This button is inside shadow DOM within an iframe.</p>
                                    <div id='shadow-result'>No clicks yet</div>
                                </div>
                            \`;
                        </script>
                    </body></html>">
                </iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>ðŸŽ¯ Test 4: Occluded Element Click</h2>
            <div class="test-info">
                <strong>What we're testing:</strong> Clicking partially occluded elements: <code>iframe#occluded-iframe >>> #occluded-btn</code>
            </div>
            <div class="iframe-container">
                <iframe id="occluded-iframe" srcdoc="
                    <html><body style='padding: 20px; font-family: Arial;'>
                        <h3>Occluded Element Test</h3>
                        <div style='position: relative;'>
                            <button id='occluded-btn' class='danger' onclick='handleClick("occluded")' style='position: relative; z-index: 1;'>Click Me (Occluded)</button>
                            <div style='position: absolute; top: -10px; left: -10px; width: 120px; height: 60px; background: rgba(255,0,0,0.3); border: 2px solid red; z-index: 2;'>Overlay</div>
                        </div>
                        <p>This button is partially occluded by a red overlay.</p>
                        <div id='occluded-result'>No clicks yet</div>
                    </body></html>">
                </iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>ðŸŽ¯ Test 5: Top-Level Button Click</h2>
            <div class="test-info">
                <strong>What we're testing:</strong> Regular top-level element clicking: <code>#top-btn</code>
            </div>
            <button id="top-btn" class="success" onclick="handleClick('top')">Click Me (Top Level)</button>
            <p>This button is at the top level of the page.</p>
            <div id="top-result">No clicks yet</div>
        </div>

        <div class="test-section">
            <h2>ðŸ§¹ Cleanup</h2>
            <button id="reset-btn" class="warning" onclick="resetAll()">Reset All Tests</button>
            <button id="clear-log-btn" class="info" onclick="clearLog()">Clear Log</button>
        </div>

        <div class="test-section">
            <h2>ðŸ“š How to Test Enhanced Click Flow</h2>
            <div class="test-info">
                <h3>Manual Testing Steps:</h3>
                <ol>
                    <li><strong>Open Browser DevTools:</strong> Press F12 or right-click â†’ Inspect</li>
                    <li><strong>Go to Console tab:</strong> This will show our enhanced click flow in action</li>
                    <li><strong>Click any button:</strong> Watch the console for detailed logging</li>
                    <li><strong>Observe the 4-phase fallback system:</strong>
                        <ul>
                            <li>Phase 1: Fast-path JS click</li>
                            <li>Phase 2: Playwright with occlusion handling</li>
                            <li>Phase 3: CDP coordinate click</li>
                            <li>Phase 4: Hard JS event dispatch</li>
                        </ul>
                    </li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        let clickCounts = {
            simple: 0,
            nested: 0,
            shadow: 0,
            occluded: 0,
            top: 0
        };

        function handleClick(type) {
            clickCounts[type]++;
            const resultElement = document.getElementById(type + '-result');
            if (resultElement) {
                resultElement.innerHTML = \`Clicked <span class='click-counter'>\${clickCounts[type]}</span> times\`;
            }
            
            // Log the click
            logClick(type, 'success');
            
            // Update status
            updateStatus(\`âœ… \${type} button clicked successfully! (Count: \${clickCounts[type]})\`);
            
            // Log to console for debugging
            console.log(\`[Enhanced Click Flow] \${type} button clicked via enhanced click flow\`);
            console.log(\`[Enhanced Click Flow] Click count: \${clickCounts[type]}\`);
        }

        function logClick(type, status) {
            const log = document.getElementById('click-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = \`[\${timestamp}] \${status.toUpperCase()}: \${type} button clicked via enhanced click flow\`;
            log.innerHTML = logEntry + '<br>' + log.innerHTML;
        }

        function updateStatus(message) {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.style.color = '#28a745';
        }

        function resetAll() {
            clickCounts = { simple: 0, nested: 0, shadow: 0, occluded: 0, top: 0 };
            document.querySelectorAll('[id$="-result"]').forEach(el => {
                el.innerHTML = 'No clicks yet';
            });
            updateStatus('ðŸ”„ All tests reset. Ready for new testing.');
        }

        function clearLog() {
            document.getElementById('click-log').innerHTML = 'Click log cleared...';
        }

        // Initialize
        updateStatus('ðŸš€ Enhanced Click Flow Test Page Loaded. Ready to test!');
        console.log('[Enhanced Click Flow] Test page loaded successfully');
        console.log('[Enhanced Click Flow] Ready to demonstrate enhanced click flow capabilities');
    </script>
</body>
</html>
    